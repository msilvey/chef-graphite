<VirtualHost *:<%= @params[:graphite_port] %>>
  ServerName <%= @params[:server_name] %>
  DocumentRoot <%= @params[:docroot] %>
  ErrorLog <%= @storage_dir %>/log/webapp/error.log
  CustomLog <%= @storage_dir %>/log/webapp/access.log common

  Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Methods "GET, OPTIONS"
  Header set Access-Control-Allow-Headers "origin, authorization, accept"

  <Location "/">
    SetHandler python-program
    PythonPath "['<%= @params[:graphite_home] %>/webapp'] + sys.path"
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE graphite.settings
    PythonDebug Off
    PythonAutoReload Off
    <% if node['apache']['version']=='2.4' -%>
    Require all granted
    <% end -%>
  </Location>

  <Location "/content/">
    SetHandler None
  </Location>

  <Location "/media/">
    SetHandler None
  </Location>

  Alias /media/ "/usr/share/pyshared/django/contrib/admin/media"
</VirtualHost>
